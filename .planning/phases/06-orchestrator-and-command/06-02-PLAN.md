---
phase: 06-orchestrator-and-command
plan: 02
type: execute
wave: 2
depends_on:
  - "06-01"
files_modified:
  - skills/dsys/dsys/SKILL.md
  - skills/dsys/dsys/generate.md
autonomous: false
requirements:
  - ORCH-01
  - ORCH-05

must_haves:
  truths:
    - "User can invoke /dsys:generate with real screenshot paths and the full pipeline executes"
    - "Parallel analysis produces one findings JSON per screenshot"
    - "Schema validation passes for all findings files and design-system.json"
    - "Platform files are generated in the correct .dsys/<name>/ subdirectories"
    - "CLAUDE.md and STYLE-GUIDE.md are written to .dsys/<name>/, not project root"
    - "End-of-run summary displays with file manifest and design system preview"
    - "Stage banners appear as each pipeline stage starts and completes"
  artifacts:
    - path: ".dsys/test-run/design-system.json"
      provides: "Synthesized design system from test run"
    - path: ".dsys/test-run/findings/"
      provides: "Analysis findings from test screenshots"
    - path: ".dsys/test-run/CLAUDE.md"
      provides: "Generated enforcement rules"
    - path: ".dsys/test-run/STYLE-GUIDE.md"
      provides: "Generated style guide"
  key_links:
    - from: "/dsys:generate command"
      to: "skills/dsys/dsys/SKILL.md"
      via: "generate.md @-include"
      pattern: "@skills/dsys/dsys/SKILL.md"
    - from: "SKILL.md orchestrator"
      to: ".dsys/test-run/"
      via: "Full pipeline execution"
      pattern: ".dsys/test-run"
---

<objective>
Validate the full `/dsys:generate` pipeline end-to-end by running it with real screenshot benchmarks and verifying every stage completes successfully.

Purpose: The orchestrator prompt is a complex multi-stage pipeline. Running it end-to-end confirms that argument parsing, parallel analysis, schema validation, synthesis, generation, rules, and the summary all work together — not just in isolation.

Output: A validated, working `/dsys:generate` command. Any issues found during the test run are fixed in the SKILL.md or generate.md files.
</objective>

<execution_context>
@/Users/james/.claude/get-shit-done/workflows/execute-plan.md
@/Users/james/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-orchestrator-and-command/06-01-SUMMARY.md
@.planning/phases/06-orchestrator-and-command/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dry-run validation of orchestrator structure</name>
  <files>skills/dsys/dsys/SKILL.md, skills/dsys/dsys/generate.md</files>
  <action>
Before running the full pipeline (which consumes significant time and context via Task agents), validate the orchestrator files structurally:

**1. generate.md validation:**
- Read `skills/dsys/dsys/generate.md`
- Verify frontmatter has: `name: dsys:generate`, `description`, `argument-hint`, `allowed-tools` (must include Read, Write, Bash, Task)
- Verify body contains `@skills/dsys/dsys/SKILL.md` reference
- Verify body contains `$ARGUMENTS`
- Verify file is under 25 lines

**2. SKILL.md structure validation:**
- Read `skills/dsys/dsys/SKILL.md`
- Verify these 5 agent paths appear in the file (exact strings):
  - `skills/dsys/agents/analyzer.md`
  - `skills/dsys/agents/synthesizer.md`
  - `skills/dsys/agents/react-generator.md`
  - `skills/dsys/agents/swiftui-generator.md`
  - `skills/dsys/agents/rules.md`
- Verify these 2 schema paths appear:
  - `skills/dsys/schemas/analysis-findings.schema.json`
  - `skills/dsys/schemas/design-system.schema.json`
- Verify the parallel execution instruction exists (search for "SINGLE response" or "single response turn" or "simultaneously")
- Verify `claude_md_path` points to `.dsys/{name}/CLAUDE.md` (not bare `CLAUDE.md`)
- Verify `--review` flag handling exists
- Verify partial failure prompt exists (search for "continue" and "abort")
- Verify `npx ajv-cli validate --spec=draft2020` command is present
- Verify end-of-run summary section exists

**3. Cross-reference validation:**
- Verify each agent file referenced in SKILL.md actually exists on disk:
  ```bash
  test -f skills/dsys/agents/analyzer.md && echo "OK" || echo "MISSING"
  test -f skills/dsys/agents/synthesizer.md && echo "OK" || echo "MISSING"
  test -f skills/dsys/agents/react-generator.md && echo "OK" || echo "MISSING"
  test -f skills/dsys/agents/swiftui-generator.md && echo "OK" || echo "MISSING"
  test -f skills/dsys/agents/rules.md && echo "OK" || echo "MISSING"
  ```
- Verify each schema file exists:
  ```bash
  test -f skills/dsys/schemas/analysis-findings.schema.json && echo "OK" || echo "MISSING"
  test -f skills/dsys/schemas/design-system.schema.json && echo "OK" || echo "MISSING"
  ```

**4. Fix any issues found:**
- If any agent or schema path is wrong, fix the reference in SKILL.md
- If generate.md is missing required frontmatter fields, add them
- If the parallel execution instruction is ambiguous, strengthen the wording
- If CLAUDE.md output path is wrong, fix it

Report all findings. If everything passes, state "Dry-run validation: all checks passed."
  </action>
  <verify>
All 5 agent files exist on disk and are referenced correctly in SKILL.md. Both schema files exist and are referenced correctly. generate.md has correct frontmatter. Parallel execution instruction is present. CLAUDE.md path is `.dsys/{name}/CLAUDE.md`.
  </verify>
  <done>
Structural validation confirms all agent references, schema references, frontmatter, and critical instructions are correct. Any mismatches have been fixed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end pipeline test with real screenshots</name>
  <files>skills/dsys/dsys/SKILL.md, skills/dsys/dsys/generate.md</files>
  <action>
Run `/dsys:generate` with the existing Luxora test screenshot (the one used in Phase 2 validation). Check for test screenshots first:

```bash
ls .dsys/findings/ 2>/dev/null
find . -name "*.png" -o -name "*.jpg" 2>/dev/null | head -5
```

Then invoke: `/dsys:generate [path-to-screenshot] --name test-run`

Walk through the interactive prompts (platform selection, confirmation). Observe stage banners. Wait for full pipeline completion.

**What was built:** The complete `/dsys:generate` slash command — orchestrator (SKILL.md) and command entry (generate.md) wiring all 5 agents into a single pipeline. The dry-run validation in Task 1 confirmed structural correctness.

**How to verify each stage:**
1. Screenshots detected and listed correctly
2. Platform selection prompt appears and accepts input
3. Confirmation step shows project name, screenshot count, platform(s)
4. Stage banners display as analysis starts
5. Analysis completes (check `.dsys/test-run/findings/` for JSON files)
6. Synthesis completes (check `.dsys/test-run/design-system.json`)
7. Platform generation completes (check `.dsys/test-run/react/` or `.dsys/test-run/swiftui/`)
8. Rules generation completes (check `.dsys/test-run/CLAUDE.md` and `.dsys/test-run/STYLE-GUIDE.md`)
9. End-of-run summary displays with file manifest and preview

**Expected output structure:**
```
.dsys/test-run/
  findings/*.json
  design-system.json
  react/src/design-system/... (if React selected)
  swiftui/Sources/DesignSystem/... (if SwiftUI selected)
  CLAUDE.md
  STYLE-GUIDE.md
```

If any stage fails: note which stage failed, what error was reported, and whether intermediate files persist on disk for debugging. Fix any issues in SKILL.md or generate.md and re-run.

**Resume signal:** Type "approved" if the pipeline ran successfully end-to-end, or describe any issues encountered.
  </action>
  <verify>
`.dsys/test-run/` directory exists with: findings/*.json, design-system.json, platform output dirs, CLAUDE.md, STYLE-GUIDE.md. Stage banners appeared. End-of-run summary displayed.
  </verify>
  <done>
The `/dsys:generate` command runs end-to-end on real screenshot input, producing a complete design system in `.dsys/test-run/`. All stages complete without error. User confirms the output is correct.
  </done>
</task>

</tasks>

<verification>
1. Dry-run validation passes: all agent/schema references correct, frontmatter valid, critical instructions present
2. End-to-end test produces findings JSONs in `.dsys/test-run/findings/`
3. End-to-end test produces `design-system.json` in `.dsys/test-run/`
4. End-to-end test produces platform files in the correct subdirectories
5. End-to-end test produces `CLAUDE.md` and `STYLE-GUIDE.md` in `.dsys/test-run/` (not project root)
6. Stage banners appeared during execution
7. End-of-run summary displayed with file manifest
</verification>

<success_criteria>
The `/dsys:generate` command runs end-to-end on real screenshot input, producing a complete design system in `.dsys/test-run/`. All stages complete without error. The user confirms the output is correct.
</success_criteria>

<output>
After completion, create `.planning/phases/06-orchestrator-and-command/06-02-SUMMARY.md`
</output>
