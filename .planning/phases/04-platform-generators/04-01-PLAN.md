---
phase: 04-platform-generators
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/dsys/agents/react-generator.md
  - src/design-system/tokens/tokens.json
  - src/design-system/tokens/tokens.css
  - src/design-system/tokens/theme.css
  - src/design-system/components/Button.tsx
  - src/design-system/components/Card.tsx
  - src/design-system/components/Input.tsx
  - src/design-system/components/Badge.tsx
  - src/design-system/components/Heading.tsx
  - src/design-system/components/Text.tsx
  - src/design-system/types/design-tokens.d.ts
  - src/design-system/index.ts
autonomous: true
requirements:
  - OUT-01
  - OUT-02
  - OUT-04
  - OUT-06
  - COMP-01
  - COMP-02

must_haves:
  truths:
    - "React generator agent prompt exists and follows the established agent anatomy (frontmatter + role + input + numbered steps + embedded spec + output template)"
    - "Running the generator against design-system.json produces all 12 React/Tailwind files (tokens.json, tokens.css, theme.css, 6 components, design-tokens.d.ts, index.ts)"
    - "theme.css starts with @import 'tailwindcss', includes @custom-variant dark, and has --color-*: initial; as first @theme declaration"
    - "tokens.css has :root (light), @media (prefers-color-scheme: dark) { :root }, and .dark blocks with all token categories (color, typography, spacing, radius, shadow)"
    - "All component files use only semantic Tailwind class names (bg-primary, text-text-muted) -- no raw hex values, no Tailwind default color names"
    - "Button component has 5 variants (primary, secondary, destructive, ghost, outline), 3 sizes (sm, md, lg), and isLoading state with spinner"
    - "Input component has 3 sizes (sm, md, lg) and error state"
    - "All components use forwardRef, accept className prop, and have displayName set"
    - "Overwrite-with-backup logic is included in the generator (read existing -> write .bak -> write new)"
  artifacts:
    - path: "skills/dsys/agents/react-generator.md"
      provides: "React/Tailwind generator agent prompt"
      min_lines: 500
    - path: "src/design-system/tokens/tokens.css"
      provides: "CSS custom properties with light, dark-auto, and dark-manual blocks"
      contains: "--ds-color-action-primary"
    - path: "src/design-system/tokens/theme.css"
      provides: "Tailwind v4 @theme configuration"
      contains: "--color-*: initial"
    - path: "src/design-system/components/Button.tsx"
      provides: "Button component with 5 variants, 3 sizes, loading state"
      contains: "isLoading"
    - path: "src/design-system/index.ts"
      provides: "Barrel file re-exporting all tokens and components"
  key_links:
    - from: "skills/dsys/agents/react-generator.md"
      to: ".dsys/design-system.json"
      via: "Read tool at runtime"
      pattern: "Read.*design-system\\.json"
    - from: "src/design-system/tokens/theme.css"
      to: "src/design-system/tokens/tokens.css"
      via: "var(--ds-*) references"
      pattern: "var\\(--ds-"
    - from: "src/design-system/components/Button.tsx"
      to: "src/design-system/tokens/theme.css"
      via: "Tailwind semantic class names"
      pattern: "bg-primary|text-inverse"
---

<objective>
Write the React/Tailwind generator agent prompt and validate it by running against the existing design-system.json.

Purpose: This agent prompt is the first of two platform generators. When invoked, it reads design-system.json and writes drop-in React/Tailwind files -- CSS custom properties, Tailwind v4 theme, TypeScript components, and barrel exports. The prompt must embed all spec content, component templates (extended beyond Phase 1 spec with ghost/outline variants and loading state), and the token resolution algorithm.

Output: `skills/dsys/agents/react-generator.md` (agent prompt) + 12 generated files in `src/design-system/` (validation output)
</objective>

<execution_context>
@/Users/james/.claude/get-shit-done/workflows/execute-plan.md
@/Users/james/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@skills/dsys/agents/synthesizer.md
@skills/dsys/references/platform-specs/react-tailwind-spec.md
@skills/dsys/references/token-schema.md
@skills/dsys/schemas/design-system.schema.json
@.dsys/design-system.json

@.planning/phases/04-platform-generators/04-RESEARCH.md
@.planning/phases/04-platform-generators/04-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write React/Tailwind generator agent prompt</name>
  <files>skills/dsys/agents/react-generator.md</files>
  <action>
Create `skills/dsys/agents/react-generator.md` following the established agent anatomy from analyzer.md and synthesizer.md:

**Frontmatter:**
```
---
name: dsys-react-generator
description: Reads design-system.json and writes React/Tailwind design system files (tokens, theme, components, types, barrel export)
tools: Read, Write
---
```

**Structure (numbered steps):**

1. **Role section:** You are the dsys React/Tailwind generator agent. You read a validated design-system.json and write drop-in React/Tailwind files. You produce CSS custom properties for runtime theming, a Tailwind v4 @theme config that replaces (not extends) defaults, TypeScript component templates using only semantic token names, and a barrel index file.

2. **Input section:** Two parameters from the orchestrator:
   - `design_system_path`: Path to design-system.json (default: `.dsys/design-system.json`)
   - `output_root`: Where to write output (default: `src/design-system/`)
   - `platforms`: Must include "react" (this agent handles only React)

3. **Step 1 - Load and validate design system:** Read design-system.json. Verify required top-level keys exist: `meta`, `tokens`, `aesthetic`, `platform_notes`. If any missing, STOP with actionable error.

4. **Step 2 - Resolve all token values:** Before writing any output, resolve ALL DTCG references and {light, dark} objects. Embed the resolution algorithm from research Pattern 2:
   - For each semantic color token $value: if string, use as-is. If {light, dark} object, resolve each side. If side is a DTCG reference like `{tokens.color.primitive.X.Y}`, look up the primitive token's $value and replace with that hex string.
   - Build a resolved lookup table: `resolvedTokens[semantic_path] = { light: "#hex", dark: "#hex" }` or `resolvedTokens[semantic_path] = "#hex"` for flat values like text.inverse.
   - Self-check: After resolution, verify NO resolved value contains `{tokens.` syntax. If any do, the resolution failed.
   - Handle null font_family values: `mono: null` -> use fallback `ui-monospace, "Cascadia Code", monospace`. `display: null` -> inherit from sans via `var(--ds-font-family-sans)`.

5. **Step 3 - Backup existing files:** For each file that will be written, attempt Read first. If the file exists, Write the existing content to `{path}.bak`. Then proceed with writing the new content. If the file does not exist, skip backup.

6. **Step 4 - Write tokens.json:** Direct DTCG transformation of design-system.json tokens into the W3C DTCG format with `primitive` and `semantic` layers. Embed the tokens.json structure from react-tailwind-spec.md Section 3. Include a header comment in $description: "Generated by dsys -- do not edit manually."

7. **Step 5 - Write tokens.css:** CSS custom properties with `--ds-` prefix. Three blocks:
   - `:root { }` with all light-mode values
   - `@media (prefers-color-scheme: dark) { :root { } }` with all dark-mode values
   - `.dark { }` with same dark-mode values (manual class toggle)
   Embed the FULL variable list from react-tailwind-spec.md Section 4. Cover ALL token categories: colors (action, surface, text, border, feedback), typography (font-family with fallback stacks, font-size as rem), spacing (all 13 steps in px), border-radius, shadows. Format font-size values as rem by dividing px value by 16 (e.g., 14px -> 0.875rem).
   Add file header comment: `/* tokens.css -- generated by dsys */` and `/* Do not edit manually -- re-run dsys to regenerate */`.

8. **Step 6 - Write theme.css:** Tailwind v4 theme configuration. Embed the FULL structure from react-tailwind-spec.md Section 5:
   - First line: `@import "tailwindcss";`
   - Second: `@custom-variant dark (&:where(.dark, .dark *));`
   - Then `@theme { }` block with `--color-*: initial;` as FIRST declaration
   - All `--color-*` variables referencing `var(--ds-*)` (never hardcoded hex)
   - Typography: `--font-sans`, `--font-mono`, `--font-display`
   - Type scale: `--text-xs` through `--text-4xl`
   - Spacing: `--spacing: 4px;` (Tailwind v4 single-value spacing)
   - Radius: `--radius-sm/md/lg/full`
   - Shadows: `--shadow-sm/md/lg`
   Include `color-mix(in srgb, ...)` for hover state variants (primary-hover, destructive-hover).

9. **Step 7 - Write component files:** Write all 6 components to `{output_root}/components/`. Each component:
   - Uses `forwardRef` (per research Pattern 5 recommendation -- all 6 for consistency)
   - Accepts `className` prop, merges as trailing string `${className ?? ""}`
   - Uses ONLY semantic Tailwind classes (bg-primary, text-text-muted, etc.) -- NEVER raw hex, NEVER Tailwind default colors
   - Sets `displayName` after declaration
   - Has `export default ComponentName` AND `export interface ComponentNameProps` (for barrel re-export)
   - Includes file header comment: `// ComponentName.tsx -- generated by dsys`

   **Component specifics -- embed these FULL templates in the agent prompt:**

   **Button.tsx:** 5 variants (primary, secondary, destructive, ghost, outline), 3 sizes (sm, md, lg), `isLoading` prop with inline spinner (`animate-spin` border technique), `aria-busy={isLoading}`, disabled when loading. Ghost variant: transparent bg, text-text color, hover:bg-surface-inset. Outline variant: transparent bg, border border-border, text-text color, hover:bg-surface-inset. Embed the FULL Button.tsx from research code examples.

   **Card.tsx:** No size variants. bg-surface-raised, rounded-lg, border border-border, shadow-sm. Accepts children.

   **Input.tsx:** 3 sizes (sm, md, lg -- per CONTEXT.md locked decision), `error` boolean prop. Sizes control padding and text size. Error state switches border to border-error. Focus ring via focus:ring-2 focus:ring-focus. Background: bg-surface-inset.

   **Badge.tsx:** 5 variants (default, success, error, warning, info). No size variants. Pill shape (rounded-full). Each variant uses opacity-based background (bg-success/10, etc.).

   **Heading.tsx:** Levels 1-4 mapping to text-4xl/3xl/2xl/xl with bold/semibold weights. Renders as h1-h4 HTML tags. Text color: text-text.

   **Text.tsx:** 3 variants (primary, secondary, muted) mapping to text colors. 3 sizes (sm, base, lg). Polymorphic `as` prop (p, span, div). Leading-relaxed.

10. **Step 8 - Write types/design-tokens.d.ts:** TypeScript union types for token names. Generate from the actual design-system.json token keys:
    - `DSColorToken`: all semantic color role names as string literals
    - `DSSpacingStep`: all spacing scale keys as number literals
    - `DSRadiusStep`: 'sm' | 'md' | 'lg' | 'full'
    - `DSFontSize`: all type scale keys as string literals

11. **Step 9 - Write index.ts:** Barrel file re-exporting all components (default + Props type), tokens.json, and types. Embed the exact structure from research code examples.

12. **Step 10 - Self-check:** Before returning, verify:
    - [ ] All 12 files written (tokens.json, tokens.css, theme.css, 6 components, design-tokens.d.ts, index.ts)
    - [ ] theme.css has `--color-*: initial;` as first @theme declaration
    - [ ] No component file contains a raw hex value (#) or Tailwind default color name (blue-500, gray-100)
    - [ ] tokens.css has all 3 blocks (:root, @media dark, .dark)
    - [ ] Button has 5 variants and isLoading
    - [ ] Input has 3 sizes
    If any check fails, fix and re-verify.

13. **Step 11 - Return summary:** Return one line: `Generated React/Tailwind design system: {file_count} files in {output_root}`

**Embed the FULL react-tailwind-spec.md as a reference section at the end of the prompt** (verbatim, per project convention). Title it: `## Reference: React/Tailwind Output Specification`.

**IMPORTANT AUTHORING NOTES:**
- The agent prompt must be self-contained -- no external @-references at runtime (established pattern from Phase 2/3).
- The component templates in the prompt must include the ghost and outline variants and isLoading state that are NOT in the Phase 1 spec (CONTEXT.md additions).
- Input size variants (sm/md/lg) must be added -- the Phase 1 spec shows a size-less Input.
- Use raw string concatenation for className merging (no cn() utility) -- per research recommendation, keeps generated components dependency-free.
- Use forwardRef on all 6 components for consistency -- per research recommendation.
  </action>
  <verify>
1. File exists: `ls -la skills/dsys/agents/react-generator.md`
2. Line count is substantial (500+ lines): `wc -l skills/dsys/agents/react-generator.md`
3. Agent anatomy verified: file has frontmatter (---), Role section, Input section, numbered Steps, Reference section
4. Key patterns present in file: `--color-*: initial`, `isLoading`, `ghost`, `outline`, `forwardRef`, `@custom-variant dark`, `tokens.json`, `.bak`, `design-system.json`
  </verify>
  <done>
A complete, self-contained React/Tailwind generator agent prompt exists at `skills/dsys/agents/react-generator.md` with all locked decision requirements embedded: 5 button variants, loading state with spinner, Input size variants, dual dark mode strategy, overwrite-with-backup logic, forwardRef on all components, barrel file, and TypeScript types.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate React generator by running against design-system.json</name>
  <files>
    src/design-system/tokens/tokens.json
    src/design-system/tokens/tokens.css
    src/design-system/tokens/theme.css
    src/design-system/components/Button.tsx
    src/design-system/components/Card.tsx
    src/design-system/components/Input.tsx
    src/design-system/components/Badge.tsx
    src/design-system/components/Heading.tsx
    src/design-system/components/Text.tsx
    src/design-system/types/design-tokens.d.ts
    src/design-system/index.ts
  </files>
  <action>
Invoke the react-generator agent by following its steps manually against the existing `.dsys/design-system.json` (Luxora forest-green system). This validates that the agent prompt produces correct output when followed literally.

Execute the agent steps:

1. Load `.dsys/design-system.json` and verify top-level keys.
2. Resolve all token values -- the Luxora system uses raw hex values (not DTCG references) for all semantic tokens, so resolution is straightforward. Handle null font_family.mono and font_family.display.
3. Skip backup (these files should not exist yet).
4. Write all 12 files following the agent prompt's instructions.

**Validation checks after generation:**

1. **File completeness:** All 12 files exist in `src/design-system/` with correct subdirectory structure (tokens/, components/, types/).

2. **tokens.css correctness:**
   - `:root` block contains `--ds-color-action-primary: #1F3A1F;` (the Luxora forest green)
   - `@media (prefers-color-scheme: dark) { :root { } }` block contains `--ds-color-action-primary: #4ADE80;`
   - `.dark { }` block contains same dark values
   - Typography section has `--ds-font-family-sans: "Satoshi", ...` with fallback stack
   - `--ds-font-family-mono` has fallback (since mono is null in design-system.json)
   - All 13 spacing steps present
   - Radius values present (sm=8px, md=16px, lg=24px, full=9999px)

3. **theme.css correctness:**
   - First line: `@import "tailwindcss";`
   - Has `@custom-variant dark (&:where(.dark, .dark *));`
   - `--color-*: initial;` is first declaration inside `@theme { }`
   - All `--color-*` values use `var(--ds-*)` references, not hardcoded hex

4. **Component correctness:**
   - Button.tsx: has `primary`, `secondary`, `destructive`, `ghost`, `outline` in variants object. Has `isLoading` prop and spinner element. Has `aria-busy`.
   - Input.tsx: has `sm`, `md`, `lg` in sizes. Has `error` prop.
   - No component file contains a raw hex string like `#1F3A1F` or a Tailwind default color like `gray-100` or `blue-500`.
   - All 6 components have `forwardRef`, `displayName`, and `className` prop.

5. **tokens.json:** Valid JSON with `primitive` and `semantic` layers. Semantic color tokens have {light, dark} $value objects.

6. **index.ts:** Exports all 6 components and their Props types.

7. **design-tokens.d.ts:** Exports DSColorToken, DSSpacingStep, DSRadiusStep, DSFontSize types.

If any check fails, fix the generated file and note what went wrong (this feedback will improve the agent prompt if needed).
  </action>
  <verify>
1. All 12 files exist: `ls -R src/design-system/`
2. No raw hex in components: `grep -r '#[0-9A-Fa-f]\{6\}' src/design-system/components/` should return nothing
3. Theme reset present: `grep 'initial' src/design-system/tokens/theme.css` returns `--color-*: initial;`
4. Dark mode blocks present: `grep -c 'prefers-color-scheme' src/design-system/tokens/tokens.css` returns 1
5. Luxora green present in tokens: `grep '1F3A1F' src/design-system/tokens/tokens.css` returns a match
6. Button has all 5 variants: `grep -c 'primary\|secondary\|destructive\|ghost\|outline' src/design-system/components/Button.tsx` returns >= 5
7. tokens.json is valid JSON: `node -e "JSON.parse(require('fs').readFileSync('src/design-system/tokens/tokens.json','utf8')); console.log('valid')"` prints 'valid'
  </verify>
  <done>
All 12 React/Tailwind files are generated from the Luxora design-system.json and pass validation: tokens.css has correct light/dark/manual-dark blocks with Luxora forest-green values, theme.css resets Tailwind defaults and references --ds-* vars, all components use semantic class names only, Button has 5 variants with loading state, Input has 3 sizes, and the barrel file exports everything.
  </done>
</task>

</tasks>

<verification>
Phase-level verification for the React/Tailwind generator:

1. Agent prompt `react-generator.md` exists and is self-contained (no external @-references at runtime)
2. Generated output matches the CONTEXT.md locked decisions:
   - Output in `src/design-system/` with `tokens/`, `components/`, `types/` subdirectories
   - Production-ready components with all specified variants and states
   - Both dark mode strategies (prefers-color-scheme + .dark class)
   - `--color-*: initial;` reset in theme.css
   - `--ds-` prefix in tokens.css
   - Overwrite-with-backup logic in agent
3. Generated files are drop-in ready -- no manual edits needed to use them
</verification>

<success_criteria>
- react-generator.md is a complete, self-contained agent prompt (500+ lines)
- Running the agent against design-system.json produces 12 files
- All generated files pass the verification checks (no raw hex in components, correct theme.css structure, correct tokens.css dark mode blocks)
- Button: 5 variants, 3 sizes, loading spinner
- Input: 3 sizes, error state
- All components: forwardRef, className, displayName
</success_criteria>

<output>
After completion, create `.planning/phases/04-platform-generators/04-01-SUMMARY.md`
</output>
