---
phase: 04-platform-generators
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/dsys/agents/swiftui-generator.md
  - Sources/DesignSystem/Colors+DesignSystem.swift
  - Sources/DesignSystem/Typography+DesignSystem.swift
  - Sources/DesignSystem/Spacing+DesignSystem.swift
  - Sources/DesignSystem/Radius+DesignSystem.swift
  - Sources/DesignSystem/Shadows+DesignSystem.swift
  - Sources/DesignSystem/Colors.xcassets/Contents.json
  - Sources/DesignSystem/Components/DSButton.swift
  - Sources/DesignSystem/Components/DSCard.swift
  - Sources/DesignSystem/Components/DSInput.swift
  - Sources/DesignSystem/Components/DSBadge.swift
  - Sources/DesignSystem/Components/DSHeading.swift
  - Sources/DesignSystem/Components/DSText.swift
  - Sources/DesignSystem/DesignSystem.swift
autonomous: true
requirements:
  - OUT-03
  - OUT-04
  - OUT-05
  - COMP-01
  - COMP-03

must_haves:
  truths:
    - "SwiftUI generator agent prompt exists and follows the established agent anatomy (frontmatter + role + input + numbered steps + embedded spec + output template)"
    - "Running the generator against design-system.json produces all SwiftUI files: 5 token extensions, asset catalog directory tree, 6 DS-prefixed components, and barrel file"
    - "Colors+DesignSystem.swift uses Color(name, bundle: .module) for all color properties -- never Color(hex:) or Color.blue"
    - "Each semantic color token has a corresponding .colorset directory with Contents.json containing light and dark sRGB values"
    - "Spacing+DesignSystem.swift uses @ScaledMetric instance properties in DSSpacing struct (not static)"
    - "All 6 components use only design system tokens (Color.dsActionPrimary, DSFont.body(), DSRadius.md) -- no raw values"
    - "DSButton has 5 variants (primary, secondary, destructive, ghost, outline), 3 sizes, and isLoading with ProgressView spinner"
    - "All components include a #Preview block and are marked public"
    - "Asset catalog colorset directory names exactly match Color() string literals (camelCase: dsActionPrimary)"
  artifacts:
    - path: "skills/dsys/agents/swiftui-generator.md"
      provides: "SwiftUI generator agent prompt"
      min_lines: 500
    - path: "Sources/DesignSystem/Colors+DesignSystem.swift"
      provides: "Color extension with all semantic color properties"
      contains: "Color(\"dsActionPrimary\", bundle: .module)"
    - path: "Sources/DesignSystem/Spacing+DesignSystem.swift"
      provides: "Spacing struct with @ScaledMetric properties"
      contains: "@ScaledMetric"
    - path: "Sources/DesignSystem/Components/DSButton.swift"
      provides: "Button component with 5 variants, 3 sizes, loading state"
      contains: "isLoading"
    - path: "Sources/DesignSystem/DesignSystem.swift"
      provides: "Barrel re-export file"
  key_links:
    - from: "skills/dsys/agents/swiftui-generator.md"
      to: ".dsys/design-system.json"
      via: "Read tool at runtime"
      pattern: "Read.*design-system\\.json"
    - from: "Sources/DesignSystem/Components/DSButton.swift"
      to: "Sources/DesignSystem/Colors+DesignSystem.swift"
      via: "Color.dsActionPrimary references"
      pattern: "Color\\.ds"
    - from: "Sources/DesignSystem/Colors+DesignSystem.swift"
      to: "Sources/DesignSystem/Colors.xcassets/"
      via: "Color(name, bundle: .module) matching colorset directory names"
      pattern: "Color\\(\"ds"
---

<objective>
Write the SwiftUI generator agent prompt and validate it by running against the existing design-system.json.

Purpose: This agent prompt is the second platform generator. When invoked, it reads design-system.json and writes drop-in SwiftUI files -- Color/Font/Spacing/Radius/Shadow extensions, asset catalog with .colorset directories, DS-prefixed component views, and a barrel re-export file. The prompt must embed the swiftui-spec.md content, extended component templates (ghost/outline variants, loading state), and the hex-to-sRGB conversion algorithm for asset catalog generation.

Output: `skills/dsys/agents/swiftui-generator.md` (agent prompt) + generated files in `Sources/DesignSystem/` (validation output)
</objective>

<execution_context>
@/Users/james/.claude/get-shit-done/workflows/execute-plan.md
@/Users/james/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@skills/dsys/agents/synthesizer.md
@skills/dsys/references/platform-specs/swiftui-spec.md
@skills/dsys/references/token-schema.md
@skills/dsys/schemas/design-system.schema.json
@.dsys/design-system.json

@.planning/phases/04-platform-generators/04-RESEARCH.md
@.planning/phases/04-platform-generators/04-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write SwiftUI generator agent prompt</name>
  <files>skills/dsys/agents/swiftui-generator.md</files>
  <action>
Create `skills/dsys/agents/swiftui-generator.md` following the established agent anatomy from analyzer.md and synthesizer.md:

**Frontmatter:**
```
---
name: dsys-swiftui-generator
description: Reads design-system.json and writes SwiftUI design system files (Color/Font/Spacing/Radius/Shadow extensions, asset catalog, DS-prefixed components, barrel export)
tools: Read, Write
---
```

**Structure (numbered steps):**

1. **Role section:** You are the dsys SwiftUI generator agent. You read a validated design-system.json and write drop-in SwiftUI files targeting iOS 16+. You produce Color extensions backed by an asset catalog for automatic OS dark mode switching, Font/Spacing/Radius/Shadow token types, DS-prefixed component views, and a barrel re-export file.

2. **Input section:** Two parameters from the orchestrator:
   - `design_system_path`: Path to design-system.json (default: `.dsys/design-system.json`)
   - `output_root`: Where to write output (default: `Sources/DesignSystem/`)
   - `platforms`: Must include "swiftui" (this agent handles only SwiftUI)

3. **Step 1 - Load and validate design system:** Read design-system.json. Verify required top-level keys exist: `meta`, `tokens`, `aesthetic`, `platform_notes`. If any missing, STOP with actionable error.

4. **Step 2 - Resolve all token values:** Same resolution algorithm as React generator. Resolve DTCG references to raw hex values. Build a lookup table of resolved semantic colors with light and dark variants. Handle null font_family values (mono=null -> `.system(size:, design: .monospaced)`, display=null -> fall through to sans font).

5. **Step 3 - Hex to sRGB conversion algorithm:** For each hex color value, convert to the sRGB decimal format required by asset catalog Contents.json. Embed this algorithm:
   ```
   For hex #RRGGBB:
     red   = parseInt(RR, 16) / 255, formatted to 3 decimal places
     green = parseInt(GG, 16) / 255, formatted to 3 decimal places
     blue  = parseInt(BB, 16) / 255, formatted to 3 decimal places
     alpha = "1.000"
   Example: #1F3A1F -> red=0.122, green=0.227, blue=0.122
   ```

6. **Step 4 - Backup existing files:** Same pattern as React generator. For each file/directory to be written, check if it exists, write .bak if so.

7. **Step 5 - Write Colors.xcassets directory:** Create the asset catalog structure:
   - `Colors.xcassets/Contents.json` (top-level manifest: `{"info":{"version":1,"author":"xcode"}}`)
   - One `.colorset/Contents.json` per semantic color token (18 semantic roles)

   **Colorset directory naming:** camelCase matching the `Color("name", bundle: .module)` string literal. Map semantic paths to colorset names:
   ```
   action.primary     -> dsActionPrimary
   action.secondary   -> dsActionSecondary
   action.destructive -> dsActionDestructive
   surface.default    -> dsSurfaceDefault
   surface.raised     -> dsSurfaceRaised
   surface.overlay    -> dsSurfaceOverlay
   surface.inset      -> dsSurfaceInset
   text.primary       -> dsTextPrimary
   text.secondary     -> dsTextSecondary
   text.muted         -> dsTextMuted
   text.inverse       -> dsTextInverse
   text.link          -> dsTextLink
   border.default     -> dsBorderDefault
   border.focus       -> dsBorderFocus
   feedback.success   -> dsFeedbackSuccess
   feedback.error     -> dsFeedbackError
   feedback.warning   -> dsFeedbackWarning
   feedback.info      -> dsFeedbackInfo
   ```

   **Contents.json structure per colorset:** Embed the exact format from swiftui-spec.md Section 4. First entry (no `appearances` key) is universal/light. Second entry (with `appearances: [{appearance: "luminosity", value: "dark"}]`) is dark. Use the sRGB decimal values from Step 3.

   **For text.inverse (flat $value "#FFFFFF"):** Use the same hex for both light and dark entries.

8. **Step 6 - Write Colors+DesignSystem.swift:** Public extension on Color with static let properties for each semantic color. All properties use `Color("tokenName", bundle: .module)`. Embed the full template from swiftui-spec.md Section 3. The property names MUST exactly match the colorset directory names (dsActionPrimary, dsSurfaceDefault, etc.).

9. **Step 7 - Write Typography+DesignSystem.swift:** DSFont struct with static functions. Use `.custom("FontName", size: N, relativeTo: .textStyle)` for non-null font families, `.system(size: N, design: .monospaced)` for null mono, and fall-through to sans for null display. Map the type scale from design-system.json to the font function sizes. Embed the full template from swiftui-spec.md Section 5.

10. **Step 8 - Write Spacing+DesignSystem.swift:** DSSpacing struct with `@ScaledMetric(relativeTo: .body)` instance properties. DSSpacingFixed enum with static CGFloat properties. Map spacing scale values from design-system.json (strip "px" suffix, convert to CGFloat). Embed the template from swiftui-spec.md Section 6. CRITICAL: `@ScaledMetric` is a PROPERTY WRAPPER -- it only works on instance properties, not static. The DSSpacing struct MUST have `public init() {}`.

11. **Step 9 - Write Radius+DesignSystem.swift:** DSRadius enum with static CGFloat properties. Map border_radius values from design-system.json (strip "px" suffix). Embed the template from swiftui-spec.md Section 7.

12. **Step 10 - Write Shadows+DesignSystem.swift:** DSShadowSize enum, DSShadowModifier ViewModifier, and View extension. Parse shadow array from design-system.json. Convert DTCG shadow values to SwiftUI .shadow() parameters:
    - offsetX/offsetY: strip "px", use as CGFloat x/y
    - blur: strip "px", use as radius
    - color: parse 8-digit hex to Color.black.opacity(alpha) where alpha = last 2 hex digits / 255
    If tokens.shadow is null, use the default values from swiftui-spec.md Section 8.

13. **Step 11 - Write component files:** Write all 6 DS-prefixed components to `{output_root}/Components/`. Each component:
    - `public struct DSComponentName: View`
    - Uses only design system tokens (Color.dsX, DSFont.x(), DSSpacing, DSRadius)
    - Includes a `#Preview` block with a comment: `// #Preview requires Xcode 15 or later. Remove if using an older Xcode version.`
    - Never uses Color.blue, Color.red, Font.body, or magic number spacing
    - Includes sensible default `accessibilityLabel` and `accessibilityAddTraits`

    **Component specifics -- embed these FULL templates in the agent prompt:**

    **DSButton.swift:** 5 variants enum (primary, secondary, destructive, ghost, outline), 3 sizes enum (sm, md, lg), `isLoading: Bool` parameter with ProgressView spinner. Enum-based init (per research Pattern 4 recommendation). Ghost variant: .clear background, .dsTextPrimary foreground. Outline variant: .clear background, .dsBorderDefault stroke overlay, .dsTextPrimary foreground. Loading state: ProgressView replaces Text, button disabled. Accessibility: `.accessibilityLabel(title)`, `.accessibilityAddTraits(.isButton)`. Embed the FULL DSButton.swift from research code examples.

    **DSCard.swift:** Generic `<Content: View>`, @ViewBuilder init. Padding from DSSpacing, background Color.dsSurfaceRaised, RoundedRectangle clip, border stroke overlay, .dsShadow(.sm).

    **DSInput.swift:** 3 sizes (sm, md, lg -- per CONTEXT.md locked decision: Button and Input get sizes), @Binding text, isError: Bool, @FocusState for border color switching. Sizes affect padding and font. Accessibility: `.accessibilityLabel(placeholder)`.

    **DSBadge.swift:** 5 variants enum (default, success, error, warning, info). Capsule shape. Opacity-based backgrounds. DSFont.label() for text.

    **DSHeading.swift:** Level enum (h1, h2, h3, h4). Maps to DSFont.heading1()-heading4(). Color.dsTextPrimary. Bold/semibold weights.

    **DSText.swift:** Variant enum (primary, secondary, muted). Size enum (sm, base, lg). Maps to DSFont.bodySmall/body/bodyLarge and Color.dsTextPrimary/Secondary/Muted.

14. **Step 12 - Write DesignSystem.swift:** Barrel re-export file. Type aliases for discoverability. Embed from research code examples.

15. **Step 13 - Self-check:** Before returning, verify:
    - [ ] All required files written (5 token extensions + asset catalog + 6 components + barrel = 13+ entries)
    - [ ] Every `Color.dsX` property in Colors+DesignSystem.swift has a matching `.colorset` directory
    - [ ] No component uses Color.blue, Color.red, Font.body, or any system color/font
    - [ ] @ScaledMetric used as instance properties (not static) in DSSpacing
    - [ ] All components have #Preview blocks
    - [ ] DSButton has 5 variants and isLoading
    If any check fails, fix and re-verify.

16. **Step 14 - Return summary:** Return one line: `Generated SwiftUI design system: {file_count} files in {output_root}`

**Embed the FULL swiftui-spec.md as a reference section at the end of the prompt** (verbatim, per project convention). Title it: `## Reference: SwiftUI Output Specification`.

**IMPORTANT AUTHORING NOTES:**
- Self-contained agent -- no external @-references at runtime.
- Component templates must include ghost/outline variants and isLoading state NOT in Phase 1 spec.
- Input size variants (sm/md/lg) must be added -- Phase 1 spec shows size-less DSInput.
- Colorset directory names MUST match Color() string literals exactly (camelCase). This is the #1 failure mode.
- The hex-to-sRGB conversion algorithm must produce 3-decimal-place strings (e.g., "0.122" not "0.12").
  </action>
  <verify>
1. File exists: `ls -la skills/dsys/agents/swiftui-generator.md`
2. Line count is substantial (500+ lines): `wc -l skills/dsys/agents/swiftui-generator.md`
3. Agent anatomy verified: file has frontmatter (---), Role section, Input section, numbered Steps, Reference section
4. Key patterns present: `Color("dsActionPrimary", bundle: .module)`, `@ScaledMetric`, `#Preview`, `isLoading`, `ghost`, `outline`, `ProgressView`, `.colorset`, `Contents.json`, `.bak`
  </verify>
  <done>
A complete, self-contained SwiftUI generator agent prompt exists at `skills/dsys/agents/swiftui-generator.md` with all locked decision requirements embedded: 5 button variants, loading state with ProgressView, Input size variants, asset catalog .colorset generation, Color(name, bundle: .module) pattern, @ScaledMetric instance properties, DS prefix, iOS 16 target, #Preview blocks, overwrite-with-backup logic, and barrel re-export.
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate SwiftUI generator by running against design-system.json</name>
  <files>
    Sources/DesignSystem/Colors+DesignSystem.swift
    Sources/DesignSystem/Typography+DesignSystem.swift
    Sources/DesignSystem/Spacing+DesignSystem.swift
    Sources/DesignSystem/Radius+DesignSystem.swift
    Sources/DesignSystem/Shadows+DesignSystem.swift
    Sources/DesignSystem/Colors.xcassets/Contents.json
    Sources/DesignSystem/Components/DSButton.swift
    Sources/DesignSystem/Components/DSCard.swift
    Sources/DesignSystem/Components/DSInput.swift
    Sources/DesignSystem/Components/DSBadge.swift
    Sources/DesignSystem/Components/DSHeading.swift
    Sources/DesignSystem/Components/DSText.swift
    Sources/DesignSystem/DesignSystem.swift
  </files>
  <action>
Invoke the swiftui-generator agent by following its steps manually against the existing `.dsys/design-system.json` (Luxora forest-green system). This validates that the agent prompt produces correct output when followed literally.

Execute the agent steps:

1. Load `.dsys/design-system.json` and verify top-level keys.
2. Resolve all token values -- Luxora uses raw hex for all semantic tokens. Handle null mono and display font families.
3. Convert hex colors to sRGB decimals for the Luxora palette:
   - #1F3A1F (forest green light) -> red=0.122, green=0.227, blue=0.122
   - #4ADE80 (green dark) -> red=0.290, green=0.871, blue=0.502
   - #F7F9F4 (sage surface) -> red=0.969, green=0.976, blue=0.957
   - (etc. for all 18 semantic colors, both light and dark)
4. Skip backup (files should not exist yet).
5. Write all files following the agent prompt's instructions.

**Validation checks after generation:**

1. **File completeness:** All expected files exist:
   - 5 token extension files (.swift)
   - Colors.xcassets/ directory with Contents.json and 18 .colorset subdirectories
   - 6 component files in Components/
   - DesignSystem.swift barrel file

2. **Asset catalog correctness:**
   - `Colors.xcassets/dsActionPrimary.colorset/Contents.json` exists
   - First color entry has no `appearances` key (light) with sRGB values matching #1F3A1F
   - Second color entry has `appearances: [{appearance: "luminosity", value: "dark"}]` with sRGB values matching #4ADE80
   - Colorset directory name `dsActionPrimary` matches the string in `Color("dsActionPrimary", bundle: .module)` in Colors+DesignSystem.swift

3. **Colors+DesignSystem.swift correctness:**
   - All 18 semantic color properties present (dsActionPrimary through dsFeedbackInfo)
   - All use `Color("name", bundle: .module)` pattern -- no Color(hex:), no Color.blue

4. **Typography+DesignSystem.swift correctness:**
   - Uses "Satoshi" as the custom font name (from design-system.json)
   - DSFont.code() uses `.system(size: 14, design: .monospaced)` since mono is null
   - Display functions fall through to Satoshi (or system) since display is null

5. **Spacing+DesignSystem.swift correctness:**
   - DSSpacing struct has `@ScaledMetric` instance properties
   - DSSpacingFixed enum has static properties
   - Values match the Luxora spacing scale (4px base)

6. **Component correctness:**
   - DSButton.swift: has `.ghost` and `.outline` in Variant enum. Has `isLoading` parameter with ProgressView. Has `.accessibilityLabel(title)`.
   - DSInput.swift: has Size enum (sm, md, lg).
   - All 6 components have `#Preview` blocks.
   - No component contains `Color.blue`, `Color.red`, `Font.body`, or raw hex values.

7. **DesignSystem.swift:** Has typealias declarations for discoverability.

If any check fails, fix the generated file and note what went wrong.
  </action>
  <verify>
1. All expected files exist: `ls -R Sources/DesignSystem/`
2. Asset catalog has colorset dirs: `ls Sources/DesignSystem/Colors.xcassets/ | grep colorset | wc -l` returns 18
3. Colorset name matches Color() string: `grep 'dsActionPrimary' Sources/DesignSystem/Colors+DesignSystem.swift` AND `ls Sources/DesignSystem/Colors.xcassets/dsActionPrimary.colorset/Contents.json`
4. No system colors in components: `grep -r 'Color\.blue\|Color\.red\|Color\.green\|Font\.body\|Font\.title' Sources/DesignSystem/Components/` returns nothing
5. @ScaledMetric is instance property: `grep '@ScaledMetric' Sources/DesignSystem/Spacing+DesignSystem.swift` returns matches AND `grep 'static.*@ScaledMetric' Sources/DesignSystem/Spacing+DesignSystem.swift` returns nothing
6. All components have #Preview: `grep -l '#Preview' Sources/DesignSystem/Components/*.swift | wc -l` returns 6
7. DSButton has 5 variants: `grep -c 'case primary\|case secondary\|case destructive\|case ghost\|case outline' Sources/DesignSystem/Components/DSButton.swift` returns 5 (or grep the full enum line)
  </verify>
  <done>
All SwiftUI files are generated from the Luxora design-system.json and pass validation: Colors.xcassets has 18 .colorset directories with correct sRGB decimal values and light/dark appearances, Colors+DesignSystem.swift uses Color(name, bundle: .module) exclusively, DSSpacing uses @ScaledMetric instance properties, DSButton has 5 variants with ProgressView loading state, DSInput has 3 sizes, all components use only design system tokens, and all include #Preview blocks.
  </done>
</task>

</tasks>

<verification>
Phase-level verification for the SwiftUI generator:

1. Agent prompt `swiftui-generator.md` exists and is self-contained (no external @-references at runtime)
2. Generated output matches the CONTEXT.md locked decisions:
   - Output in `Sources/DesignSystem/` with token extensions, Components/ subdirectory, and asset catalog
   - Color(name, bundle: .module) pattern -- never Color(hex:)
   - Asset catalog .colorset directories with light and dark sRGB values
   - @ScaledMetric instance properties in DSSpacing
   - DS-prefixed components with #Preview blocks
   - iOS 16 minimum target (no iOS 17+ APIs)
   - Production-ready components with all specified variants and states
   - Overwrite-with-backup logic in agent
3. Generated files are drop-in ready -- can be added to Xcode project or Swift Package without manual edits
</verification>

<success_criteria>
- swiftui-generator.md is a complete, self-contained agent prompt (500+ lines)
- Running the agent against design-system.json produces all expected files
- All generated files pass the verification checks (asset catalog names match Color() strings, no system colors, @ScaledMetric is instance, #Preview present)
- DSButton: 5 variants, 3 sizes, ProgressView loading
- DSInput: 3 sizes, error state
- 18 .colorset directories with correct Contents.json structure
</success_criteria>

<output>
After completion, create `.planning/phases/04-platform-generators/04-02-SUMMARY.md`
</output>
